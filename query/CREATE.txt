CREATE DATABASE InstantFlow;

USE InstantFlow;

CREATE TABLE films (
    id INT PRIMARY KEY AUTO_INCREMENT,
    titolo VARCHAR(50) UNIQUE NOT NULL,
    descrizione VARCHAR(500),
    dataUscita DATE NOT NULL
    )ENGINE='InnoDB';

CREATE TABLE utenti (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) NOT NULL,
    cognome VARCHAR(30) NOT NULL,
    email VARBINARY(100) UNIQUE NOT NULL,
    password VARCHAR(70) NOT NULL,
    isAdmin BOOLEAN NOT NULL
    )ENGINE='InnoDB';

CREATE TABLE categorie (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) UNIQUE NOT NULL,
    prezzo FLOAT NOT NULL,
    CHECK (prezzo >= 0)
    )ENGINE='InnoDB';

CREATE TABLE abbonamenti (
    id INT PRIMARY KEY AUTO_INCREMENT,
    dataFine DATE NOT NULL,
    idUtente INT NOT NULL,
    idCategoria INT NOT NULL,
    FOREIGN KEY (idUtente) REFERENCES utenti(id) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (idCategoria) REFERENCES categorie(id) ON UPDATE CASCADE ON DELETE CASCADE,
    CHECK (dataFine > CURDATE())
    )ENGINE='InnoDB';

CREATE TABLE attori (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) NOT NULL,
    cognome VARCHAR(30) NOT NULL
    )ENGINE='InnoDB';

CREATE TABLE recita (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idAttore INT,
    idFilm INT,
    FOREIGN KEY (idAttore) REFERENCES attori(id) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (idFilm) REFERENCES films(id) ON UPDATE CASCADE ON DELETE CASCADE
    )ENGINE='InnoDB';

CREATE TABLE generi (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) UNIQUE NOT NULL
    )ENGINE='InnoDB';

CREATE TABLE appartiene (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idGenere INT,
    idFilm INT,
    FOREIGN KEY (idGenere) REFERENCES generi(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (idFilm) REFERENCES films(id) ON DELETE CASCADE ON UPDATE CASCADE
    )ENGINE='InnoDB';

CREATE TABLE guarda (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idUtente INT,
    idFilm INT,
    durata TIME,
    FOREIGN KEY (idUtente) REFERENCES utenti(id) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (idFilm) REFERENCES films(id) ON UPDATE CASCADE ON DELETE CASCADE
    )ENGINE='InnoDB';